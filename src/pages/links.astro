---
import { pages, settings, flux } from '../utils/ghost-store.js';
import { normalizeData } from '../utils/help';

import BaseLayout from '../layouts/BaseLayout.astro';
import Head from '../components/Head.astro';
import Comments from '../components/Comments.astro';
import Header from '../components/Header.astro';
import Menu from '../components/Menu.astro';
import PostMeta from '../components/PostMeta.astro';
import { Markup } from 'astro-remote';
import CodeSlot from '../components/CodeSlot.astro';
import IFrameSlot from '../components/IFrameSlot.astro';
import RemotePicture from '../components/RemotePicture.astro';
import Columns from '../components/shortcode/Columns.astro';
import Details from '../components/shortcode/Details.astro';
import Link from '../components/shortcode/Link.astro';
import { UsersRound } from '@lucide/astro';

const page = pages.find((post) => post.slug == 'links');
---

<BaseLayout post={page}>
    <Head slot="head" post={page} site={settings} title={page?.title + ' | ' + settings?.title + ' - ' + settings?.description} />

    <Header slot="header" title={page.title} />
    <Menu slot="menu" />

    <article slot="content" class="markdown book-article">
        <h1 class="book-title"><UsersRound /> {page.title}</h1>

        {
            page.html && (
                <Markup
                    content={page.html}
                    sanitize={{ allowComponents: true, allowCustomElements: true }}
                    components={{ pre: CodeSlot, img: RemotePicture, iframe: IFrameSlot, details: Details, columns: Columns, a: Link }}
                />
            )
        }
        <div class="book-columns flex flex-wrap">
            {
                flux.map((item) => (
                    <div class="flex-even markdown-inner">
                        <h3 class="book-title flex">
                            {/* <div
                                class="og-image bislight"
                                style={
                                    'width: 1.5em;margin-right: 0.3em;height: 1.5em;background-image: url(https://favicon.splitbee.io/?url=' +
                                        item.feed?.site_url +
                                        ');' || ''
                                }
                            /> */}
                            <img
                                loading="lazy"
                                style="width: 1.5em;margin-right: 0.3em;"
                                src={'https://favicon.splitbee.io/?url=' + (item.feed?.site_url || '')}
                            />
                            <Link href={item.feed?.site_url || '#'} class="ellipsis" target="_blank">
                                {item.feed?.title || 'Unknown Feed'}
                            </Link>
                        </h3>

                        <div class="ellipsis">
                            <Link href={item.url || item.link || '#'} class="ellipsis" target="_blank">
                                {item.title || 'Untitled'}
                            </Link>
                        </div>
                        <div>
                            <span>{normalizeData(item.published_at || item.created_at || item.date)}</span>
                        </div>
                    </div>
                ))
            }
        </div>
    </article>
    <Comments slot="comments" />
</BaseLayout>
