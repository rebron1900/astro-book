---
import { settings } from '../utils/ghost-store';
import { StickyNote, HouseHeart, MessageCircleHeart, Sparkles, Sprout, Images, TentTree, Package, Tags, Flower2, DoorOpen } from '@lucide/astro';

const { title } = Astro.props;

const EMOJI_SEQ = /(\p{RI}\p{RI}|\p{Emoji}(\p{Emoji_Modifier}|\u200D\p{Emoji})*)$/u;

const ICON_MAP = {
    'ğŸ“„': StickyNote,
    'ğŸ ': HouseHeart,
    'ğŸš©': MessageCircleHeart,
    'ğŸ“–': Sparkles,
    'ğŸ˜': Sprout, // â† è¿™é‡Œä¸€å®šè¦â€œå¤åˆ¶ç²˜è´´â€
    'ğŸš§': Images,
    'ğŸ‘£': TentTree,
    'ğŸª´': Flower2,
    'ğŸ“¦': Package,
    'ğŸ“Œ': Tags,
    'ğŸ§‘â€ğŸ¤â€ğŸ§‘': DoorOpen // åŒæ ·å¤åˆ¶ç²˜è´´
};

const nav = settings?.navigation ?? [];

const menus = nav.map((rawItem) => {
    // å…ˆå‡†å¤‡è¿”å›éª¨æ¶
    const node: { icon?: any; item: typeof rawItem; cleanLabel?: any } = { item: rawItem };

    // å°è¯•æ‘˜ emoji
    const emojiMatch = rawItem.label.match(EMOJI_SEQ);
    if (emojiMatch) {
        const emoji = emojiMatch[1];
        const Comp = ICON_MAP[emoji];
        if (Comp) {
            node.icon = Comp; // åªåœ¨æ–°ç»“æ„é‡Œæ”¾å›¾æ ‡
            node.cleanLabel = rawItem.label.replace(EMOJI_SEQ, '').trim();
        }
    }
    return node;
});
---

<ul class="book-menu-nav">
    <li class="book-section-flat">
        <span>è·¯çº¿ç‰Œ</span>

        <ul class="book-collspan">
            {
                title && (
                    <li>
                        {/* prettier-ignore */}
                        <a href="javascript:void(0)" class="menu-flag current ellipsis">
                            <StickyNote class="book-icon" />{title}
                        </a>
                    </li>
                )
            }

            {
                menus.map(({ icon: Icon, item, cleanLabel: CleanLabel }) => (
                    <li>
                        {/* prettier-ignore */}
                        <a href={item.url} class={`menu-flag ellipsis ${Astro.url.pathname == item.url ? 'current' : ''}`}>
                            {Icon && <Icon class="book-icon" />}{CleanLabel || item.label}
                        </a>
                    </li>
                ))
            }
        </ul>
    </li>
</ul>
