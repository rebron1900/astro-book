---
import { settings } from '../utils/ghost-store';
import { StickyNote, HouseHeart, MessageCircleHeart, Sparkles, Sprout, Images, TentTree, Archive, Tags, Flower2, DoorOpen } from '@lucide/astro';

const { title } = Astro.props;

const EMOJI_SEQ = /(\p{RI}\p{RI}|\p{Emoji}(\p{Emoji_Modifier}|\u200D\p{Emoji})*)$/u;

const ICON_MAP = {
    'ğŸ“„': StickyNote,
    'ğŸ ': HouseHeart,
    'ğŸš©': MessageCircleHeart,
    'ğŸ“–': Sparkles,
    'ğŸ•µï¸â€â™‚ï¸': Sprout,
    'ğŸš§': Images,
    'ğŸ‘£': TentTree,
    'ğŸª´': Flower2,
    'ğŸ“¦': Archive,
    'ğŸ“Œ': Tags,
    'ğŸ§‘â€ğŸ¤â€ğŸ§‘': DoorOpen
    /* æƒ³åŠ å›¾æ ‡ç»§ç»­å¾€ä¸‹å†™å³å¯ */
};

/*
 é¦–é¡µ ğŸ 
å·¦é‚»å³èˆ ğŸ§‘â€ğŸ¤â€ğŸ§‘
Now ğŸš©
 ä¹¦å½±éŸ³æ¸¸ ğŸ“–
å…³äº ğŸ•µï¸â€â™‚ï¸
å½±é›† ğŸš§
è¶³è¿¹ ğŸ‘£
å¥½å¥‡å¿ƒèŠ±å›­ğŸª´
å½’æ¡£ ğŸ“¦
Tags ğŸ“Œ
*/
const nav = settings?.navigation ?? [];

const menus = nav.map((rawItem) => {
    // å…ˆå‡†å¤‡è¿”å›éª¨æ¶
    const node: { icon?: any; item: typeof rawItem; cleanLabel?: any } = { item: rawItem };

    // å°è¯•æ‘˜ emoji
    const emojiMatch = rawItem.label.match(EMOJI_SEQ);
    if (emojiMatch) {
        const emoji = emojiMatch[1];
        const Comp = ICON_MAP[emoji];
        if (Comp) {
            node.icon = Comp; // åªåœ¨æ–°ç»“æ„é‡Œæ”¾å›¾æ ‡
            node.cleanLabel = rawItem.label.replace(EMOJI_SEQ, '').trim();
        }
    }
    return node;
});
---

<ul class="book-menu-nav">
    <li class="book-section-flat">
        <span>è·¯çº¿ç‰Œ</span>

        <ul class="book-collspan">
            {
                title && (
                    <li>
                        {/* prettier-ignore */}
                        <a href="javascript:void(0)" class="menu-flag current ellipsis">
                            <StickyNote class="book-icon" />{title}
                        </a>
                    </li>
                )
            }

            {
                menus.map(({ icon: Icon, item, cleanLabel: CleanLabel }) => (
                    <li>
                        {/* prettier-ignore */}
                        <a href={item.url} class={`menu-flag ellipsis ${Astro.url.pathname == item.url ? 'current' : ''}`}>
                            {Icon && <Icon class="book-icon" />}{CleanLabel}
                        </a>
                    </li>
                ))
            }
        </ul>
    </li>
</ul>
